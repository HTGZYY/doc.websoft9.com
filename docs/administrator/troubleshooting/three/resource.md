---
sidebar_position: 1
slug: /troubleshooting/resource
---


# 资源瓶颈典型范例

#### 网站访问很慢？{#siteslow}

网站慢最常见的原因包括如下几个方面：

* 带宽不够
* 服务器满负荷运转
* 图片、视频、CSS/JS等静态资源太多

我们在大量的实践中，发现中国的云用户（国外的云平台用户没有这个问题）普遍存在**带宽不够**的问题。  

为什么会出现这样的问题呢？

一方面是由特殊带宽计费商业模式导致，另外一方面中国地区的用户对带宽的大小是没有概念的，是模糊乃至错误的认知。  

**举例说明：**

如果您拥有**2M**的**包年包月**带宽，打开一个首页大概为4M的网站，大概需要几秒时间？

80%的用户认为应该是在2-3s内打开，实际上呢？

```
1M 带宽 = 128k/s 的下载速度
2M 带宽 = 256k/s 的下载速度
4M 页面的最小下载速度：4000k/256=15.6s
```

这个15.6s还没有考虑服务器的计算、网络延时等时间，所以访问一个带宽只有2M带宽的网站，需要20s也就不足为奇了。

**如何正确选择带宽？**

正确的方式：服务器采用**按量付费的带宽**，带宽的大小设置为最大（有些云平台高达 300M/s）

> 国外的主流云厂商，没有包年包月带宽这种选项，故没有错误选择带宽的困扰。

带宽大小与费用没有关系。按量付费规则下，是根据服务器的被下载量计算费用，用多少给多少。

**例如**：当前网站所有访问加起来的下载量为：5G，费用大概是：5×0.5 = 2.5元

另外针对静态资源较多的情况，我们建议：

1. 采用CDN
2. 网站图片超过1000张，建议从服务器中分离出去

以上方案简单可靠，降低服务器资源消耗，实现成本较低，效果好。

#### MySQL 日志导致磁盘空间不足？

默认安装，mysql会自动开启binlog，binlog是一个二进制格式的文件，用于记录用户对数据库**更新的****SQL语句****信息**，例如更改数据库表和更改内容的SQL语句都会记录到binlog里。

binlog主要用于出现没有备份的情况下，恢复数据库。但binlog会占用较大空间，长期不清理会让剩余磁盘空间为0，从而影响数据库或服务器无法启动

如果对自己的备份有信心，不需要binlog功能，参考如下步骤关闭之：

1. 编辑 [MySQL 配置文件](../mysql#path)，注释掉 binlog 日志
  ~~~
  #log-bin=mysql-bin  
  ~~~

2. 重启 MySQL 服务

#### 端口冲突？

例如：Apache默认端口为 80，MySQL默认端口为 3306；可以通过cmd控制台输入指令：netstat -ano，查看服务器端口的使用情况。  

如果发送端口冲突故障，具体解决方法如下：

1. 找到 Apache 的配置文件（包括 httpd.conf 和站点配置文件），将端口 80 改为其他端口，如：81，然后重启 Apache。
**注意：更改端口后，需要将安全组的对应端口开放出来，否则服务正常启动，但外网依然无法访问网站。**
2. 找到 MySQL 的配置文件 my.ini ，将其中的 port = 3306 改为其他端口，然后重启MySQL服务。
3. 通过 netstat -ano 命令查看是哪个程序或服务占用了 80 或 3306 端口，可根据 PID 到任务管理器或服务列表将其关闭，再重新启动 Apache 和 MySQL。



