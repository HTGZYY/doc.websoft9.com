---
sidebar_position: 1.3
slug: /app-compose
---

# 应用编排与自主配置

对于重建来说，不管应用中的容器存在或被删除，都可以被重建，最大程度上保持重建工作的灵活性。 

编排即重新配置应用，它的编排的对象是一个 100% 的 Docker Compose 项目，所有熟悉 Docker 的用户编排它是轻车熟路的。  

## 为什么要编排？

Websoft9 提供的是应用模板，它满足了最快启动应用的一切，但它无法满足您各种个性化问题：

- 需要使用自定义的数据库：例如云 RDS
- 个性化的用户名和密码
- 为某些应用配置缓存
- 更改持久化存储目录
- 应用自身的配置
- 可设置的白名单
- 需删除应用的容器后再创建
- ...

所以，我们需要将应用的编排完全开放个用户，以满足各种个性化需求。  


## 怎样编排？{#howto-reup}

Websoft9 运行机制是 GitOps 驱动，即先在 Git 中定义应用所需的资源，再将资源文件推送到 Runner 中运行。  

所有，我们的编排工作步骤如下：

1. Websoft9 控制台，通过 **我的应用** 菜单进入任何一个应用的管理界面
   ![](./assets/websoft9-composeedit.png)

2. 点击 “编排” 标签页的【马上修改】按钮，系统跳转到 **Git 仓库**的项目管理页面

2. 在可视化的仓库管理页面，选择 .env 或 docker-compose.yml 进行修改（所有文件均可修改）
   ![](./assets/websoft9-composeedit.png)

3. 回到我的应用的**编排**标签页，点击【重建应用】链接或右上角的重建图标

4. 等待重建完成


> W9_ 开头的环境变量一般不要去修改。


## 场景

下面再以一些特殊的场景为例，让您更灵活管理应用。  

### 删除指定容器后再重建

Websoft9 的**我的应用**标签页并不支持删除指定容器后再重建，但可以通过其他功能结合使用：

1. 进入左侧主菜单的：【容器】>【Stacks】

2. 进入 Stack 后找到应用，删除目标容器

3. 可选操作：在容器管理界面中的【Volumes】页面，删除目标容器的 Volume

4. 回到我的应用界面，重建容器

### 开启数据库外网端口

提供两种方式开放数据库的外网端口：

- 方式一：需要重新编排应用的 *docker-compose.yml* 文件，修改其中数据库的 port 绑定，然后重建应用

- 方式二：通过 Websoft9 域名管理界面中，新建一个 Stream 代理，实现端口转发到服务器



## 常见问题



#### 环境变量修改后为什么有些不生效？

有些环境变量仅用于容器的首次创建，后续修改是不生效的。例如：MYSQL_PASSWORD  

这是由各个容器镜像的作者决定的，Websoft9 无法对它进行控制，也没有必要改变它的这种特征。    

#### 编排如何影响网关的？

技术实现层面，当用户通过 Websoft9 应用商店安装的应用时，平台核心组件调研网关 API ，为应用创建一个转发的配置。  

**网关是如何与 Websoft9 应用商店进行协作的？**     

当用户，应用管理器会调用网关的 API 接口，基于接口自动创建域名绑定到容器端口，帮助程序实现 **域名** 访问。 依次类推，修改域名、删除应用等操作，都会调用网关的 API 接口，完成所需的操作。 

网关需具备一定的 HTTP 服务应用经验的用户使用，否则很容易破坏已安装应用的访问。 


