---
title: Ansible
slug: /ansible
tags:
  - Ansible
  - DevOps
---

import Meta from './_include/ansible.md';

<Meta name="meta" />


## Getting started{#guide}

### Quick trial

Before experiencing Ansible, you need to prepare the connection information(IP, user, and password) for the console before you start testing:  

1. After installing Ansible in the Websoft9 console, view the application details in **My Apps**, and acccess to the container's by ***Exec Console**.  

2. Run the following test commands to verify that Ansible is working properly.  
   ```
   # Viewing the help
   ansible -h

   # View system information
   ansible localhost -m setup
   ```

3. Run the test example that already exists in the container.
   ```
   cd test

   # Set up the connection information for the console
   vim inventory

   # Start the run command
   ansible-playbook -i inventory playbook.yml
   ``

### Common commands

Ansible-playbook is the most common command and the main entrypoint for running programs.  

In fact, Ansible also supports running [Ad-doc](https://docs.ansible.com/ansible/2.9/user_guide/intro_adhoc.html) in a single command to use the module to achieve our deployment goals.  

   ```
   # Print local disk information
   ansible localhost -m command -a 'df -h'

   # Get facts information
   ansible localhost -m setup

   # Connectivity test
   ansible all -m ping

   # Install docker-composer locally
   ansible localhost -m get_url -a "url=https://getcomposer.org/composer-stable.phar dest=/usr/bin/composer mode=0750"
   ```

Command explanation:

* localhost/all: hostname/IP/grouping
* -m: specify module (default is command, so you can remove the -m command one)
* command/setup/ping: module name
* -a: module parameters
* 'df -h': parameter value

### Host inventory

[Ansible Inventory](https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#intro-inventory)(Host inventory) is a technical standard for flexible host information management. The following is an example of a hosts file that contains a wealth of information.  

The following is an example of a hosts file that contains a wealth of information:  

```
[webservers]
86.21.14.177
web1.websoft9.com
we2.websoft9.com
192.165.2.50

[database]
86.21.14.172
host1.websoft9.com
host2.websoft9.com
192.165.2.51

[monitor]
86.21.14.173 ansible_user=root ansible_ssh_pass=123456 proxy=proxy.websoft9.com
86.21.14.174 ansible_user=root ansible_ssh_private_key_file=/root/mykey
host1.websoft9.com
www[01:50].example.com

[monitor:vars]
proxy=proxy.websoft9.com
```

Description of the variables in the list of hosts:

| ansible_ssh_host | Remote Host |
| ---------------------------- | ------------------------------------ |
| ansible_ssh_port | Specifies the original host ssh port |
| ansible_ssh_root | ssh user connecting to the remote host |
| ansible_ssh_pass | Password for ssh connection to remote host | | ansible_ssh_pass
| ansible_sudo_pass | sudo password |
| ansible_connection | Specify connection type: local, ssh, paramiko |
| ansible_ssh_private_key_file | The private key to use for ssh connections |
| ansible_shell_type | Specify the type of shell to use for the connection, sh, csh, fish |
| ansible_python_interpreter | Specify the python path to be used by the remote host |


### Configuration file{#cfg}

Ansible supports multiple locations for the ansible.cfg configuration file, including:

* . /ansible.cfg ansible.cfg in the current working directory
* ~/.ansible.cfg in the current user's home directory
* /etc/ansible/ansible.cfg ansible.cfg automatically generated by installation
* ANSIBLE_CONFIG Environment variable for the environment path of the configuration file

What if there are multiple configuration files? Ansible has a prioritization scheme: environment variables > current working directory > user home directory > etc


The following are commonly used configuration items:

| Item              | Description                                                  | Example                           |
| ----------------- | ------------------------------------------------------------ | ------------------------------- |
| log_path          | The address of the log file, Ansible does not log by default, you need to customize it.             | log_path = /var/log/ansible.log |
| inventory         | Resource list (host list) file location                                 | inventory = /etc/ansible/hosts  |
| library           | Module directory with default values                                         | library = /usr/share/ansible    |
| forks             | Maximum number of working processes, default value is 5                       | forks = 10                      |
| sudo_user         | Setting the Default User for Running Ansible Programs                            | sudo_user = root                |
| remote_port       | Port of the remote host, used to connect to the managed host, default value is 22      | remote_port = 22                |
| host_key_checking | Whether to check the secret key of the SSH host, the default is True. it is applicable to the error message that the secret key of the same managed host has been changed, if you don't want to see this message, you can set this item to False.  | host_key_checking = False       |
| timeout           | Setting the SSH timeout for connecting to a remote host                              | timeout = 60                    |  


## Configuration options{#configs}

- Ansible Configuration file: */etc/ansible/ansible.cfg*  
- Ansible Example catalog: */ansible/project* 
- Version: `ansible --version`
- Environment Variables: Environment variables that begin with ANSIBLE_ have a relationship to ansible.cfg. For example: export ANSIBLE_SUDO_USER=root
- Ansible visualization tool: Red Hat Ansible Automation Platform
- Command line: 
   - [ansible](https://docs.ansible.com/ansible/latest/cli/ansible.html): Main command
   - [ansible-config](https://docs.ansible.com/ansible/latest/cli/ansible-config.html): Configuration file and configuration item modifications
   - [ansible-console](https://docs.ansible.com/ansible/latest/cli/ansible-console.html): Run ansible commands interactively
   - [ansible-doc](https://docs.ansible.com/ansible/latest/cli/ansible-doc.html): Query Documentation
   - [ansible-galaxy](https://docs.ansible.com/ansible/latest/cli/ansible-galaxy.html): galaxy project library release and download
   - [ansible-inventory](https://docs.ansible.com/ansible/latest/cli/ansible-inventory.html): Mainframe inventory management
   - [ansible-playbook](https://docs.ansible.com/ansible/latest/cli/ansible-playbook.html): Run the playbook
   - [ansible-pull](https://docs.ansible.com/ansible/latest/cli/ansible-pull.html): Pull and run the playbook program
   - [ansible-vault](https://docs.ansible.com/ansible/latest/cli/ansible-vault.html): Encryption processing


## Administer{#administrator}

## Troubleshooting{#troubleshooting}

#### python-urllib3 reporting errors?

In most cases, python-urllib3 errors are solved by yum install python-urllib3, not pip install.

#### account is accurate, but still can't connect to the controlled machine?

Empty the */root/.ssh/known_hosts* file on the server.

#### Does Ansible support dynamic host inventories?

Yes. Because in a real-world production scenario, maintaining these lists manually would be a very tedious task if the manifests were used.  

Ansible supports dynamic production of host lists, where ansible.cfg points to a program that produces host lists, which in turn produces a formatted list of lists.

#### Does Ansible have default grouping?

Yes. By default, there is an all group that contains all hosts of a file, and an ungrouped group that is unattributed.


#### What are the Ansible variable priorities?

From highest to lowest: variables brought in by ansible commands > cfg configuration file variables > main project var variables > role var variables > role default variables

#### Does Ansible have a concept of global variables?

No, it doesn't.


#### Are the client and server Python versions the same?

Yes, you can.

#### What built-in variables does Ansible have?

Ansible has three types of built-in variables:

* [System variables (environment variables)](https://docs.ansible.com/ansible/latest/reference_appendices/config.html) used for ansible.cfg configuration
* [Special Variables](https://docs.ansible.com/ansible/latest/reference_appendices/special_variables.html) used for work processes
* [Facts variables](https://docs.ansible.com/ansible/latest/user_guide/playbooks_vars_facts.html) collected on the controlled side
